{
 "actions": [],
 "allow_rename": 1,
 "creation": "2026-01-27 10:00:00.000000",
 "doctype": "DocType",
 "editable_grid": 1,
 "engine": "InnoDB",
 "field_order": [
  "enabled",
  "section_break_1",
  "nextcloud_url",
  "username",
  "password",
  "section_break_2",
  "folder_prefix",
  "section_break_features",
  "auto_create_folders",
  "add_comments",
  "send_notifications",
  "log_events",
  "auto_retry_failed",
  "max_retry_attempts",
  "section_break_3",
  "use_ssh",
  "ssh_host",
  "ssh_user",
  "ssh_key_path",
  "nextcloud_path",
  "occ_user",
  "section_break_4",
  "use_service_token",
  "cf_client_id",
  "cf_client_secret"
 ],
 "fields": [
  {
   "default": "0",
   "fieldname": "enabled",
   "fieldtype": "Check",
   "label": "Enable Nextcloud Integration",
   "description": "Master switch to enable or disable the entire Nextcloud integration. When disabled, no folders will be created automatically or manually."
  },
  {
   "fieldname": "section_break_1",
   "fieldtype": "Section Break",
   "label": "Nextcloud Configuration"
  },
  {
   "default": "https://cloud.alkhora.com",
   "fieldname": "nextcloud_url",
   "fieldtype": "Data",
   "label": "Nextcloud URL",
   "reqd": 1
  },
  {
   "fieldname": "username",
   "fieldtype": "Data",
   "label": "Username",
   "reqd": 1
  },
  {
   "fieldname": "password",
   "fieldtype": "Password",
   "label": "Password / App Password",
   "reqd": 1
  },
  {
   "fieldname": "section_break_2",
   "fieldtype": "Section Break",
   "label": "Folder Settings"
  },
  {
   "default": "Opportunity-",
   "fieldname": "folder_prefix",
   "fieldtype": "Data",
   "label": "Folder Prefix",
   "description": "Prefix to add before opportunity name. Folders are created in: /ALKHORA/استيرادية {YEAR}/{prefix}{opportunity_name}"
  },
  {
   "fieldname": "section_break_features",
   "fieldtype": "Section Break",
   "label": "Extra Features"
  },
  {
   "default": "1",
   "fieldname": "auto_create_folders",
   "fieldtype": "Check",
   "label": "Auto-Create Folders on Opportunity Creation",
   "description": "Automatically create Nextcloud folders when new opportunities are created. If disabled, folders can still be created manually using the button."
  },
  {
   "default": "1",
   "fieldname": "add_comments",
   "fieldtype": "Check",
   "label": "Add Comments to Opportunities",
   "description": "Add a comment to the opportunity when a folder is successfully created."
  },
  {
   "default": "1",
   "fieldname": "send_notifications",
   "fieldtype": "Check",
   "label": "Send Realtime Notifications",
   "description": "Send realtime notifications to users when folder creation completes (success or failure)."
  },
  {
   "default": "1",
   "fieldname": "log_events",
   "fieldtype": "Check",
   "label": "Log Folder Creation Events",
   "description": "Log all folder creation events to ERPNext Error Log for debugging and auditing."
  },
  {
   "default": "1",
   "fieldname": "auto_retry_failed",
   "fieldtype": "Check",
   "label": "Auto-Retry Failed Folder Creations",
   "description": "Automatically retry failed folder creation attempts. Useful for temporary network issues."
  },
  {
   "default": "3",
   "fieldname": "max_retry_attempts",
   "fieldtype": "Int",
   "label": "Maximum Retry Attempts",
   "description": "Maximum number of retry attempts for failed folder creations (1-10). Only used if Auto-Retry is enabled.",
   "depends_on": "eval:doc.auto_retry_failed == 1"
  },
  {
   "fieldname": "section_break_3",
   "fieldtype": "Section Break",
   "label": "SSH Configuration (Optional - For Fastest Performance)"
  },
  {
   "default": "0",
   "fieldname": "use_ssh",
   "fieldtype": "Check",
   "label": "Use SSH + OCC (Fastest Method)",
   "description": "Enable to use SSH to execute OCC commands directly on Nextcloud server. Requires SSH access."
  },
  {
   "fieldname": "ssh_host",
   "fieldtype": "Data",
   "label": "SSH Host",
   "description": "SSH hostname or IP (e.g., cloud.alkhora.com or via Cloudflare tunnel)"
  },
  {
   "fieldname": "ssh_user",
   "fieldtype": "Data",
   "label": "SSH Username",
   "description": "SSH username (e.g., root, www-data, or your user)"
  },
  {
   "fieldname": "ssh_key_path",
   "fieldtype": "Data",
   "label": "SSH Key Path (Optional)",
   "description": "Path to SSH private key file on ERPNext server. Leave empty to use default SSH key."
  },
  {
   "fieldname": "nextcloud_path",
   "fieldtype": "Data",
   "label": "Nextcloud Installation Path",
   "description": "Full path to Nextcloud installation (e.g., /var/www/nextcloud)"
  },
  {
   "default": "www-data",
   "fieldname": "occ_user",
   "fieldtype": "Data",
   "label": "OCC User",
   "description": "User to run OCC command as (usually www-data or apache). The SSH user must have sudo permissions to run commands as this user."
  },
  {
   "fieldname": "section_break_4",
   "fieldtype": "Section Break",
   "label": "Cloudflare Access Service Token (Optional - Alternative to IP Bypass)"
  },
  {
   "default": "0",
   "fieldname": "use_service_token",
   "fieldtype": "Check",
   "label": "Use Cloudflare Service Token",
   "description": "Enable to use Cloudflare Access Service Token instead of IP-based bypass. Requires cloudflared to be installed on ERPNext server."
  },
  {
   "fieldname": "cf_client_id",
   "fieldtype": "Data",
   "label": "Cloudflare Client ID",
   "description": "Service Token Client ID from Cloudflare Zero Trust > Access > Service Tokens"
  },
  {
   "fieldname": "cf_client_secret",
   "fieldtype": "Password",
   "label": "Cloudflare Client Secret",
   "description": "Service Token Client Secret from Cloudflare Zero Trust > Access > Service Tokens"
  }
 ],
 "index_web_pages_for_search": 1,
 "is_single": 1,
 "links": [],
 "modified": "2026-01-27 10:00:00.000000",
 "modified_by": "Administrator",
 "module": "Nextcloud Integration",
 "name": "Nextcloud Settings",
 "owner": "Administrator",
 "permissions": [
  {
   "create": 1,
   "delete": 1,
   "email": 1,
   "export": 1,
   "print": 1,
   "read": 1,
   "role": "System Manager",
   "share": 1,
   "write": 1
  }
 ],
 "sort_field": "modified",
 "sort_order": "DESC",
 "states": [],
 "track_changes": 1
}
